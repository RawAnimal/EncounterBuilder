<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Version 1.2 -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Encounter Builder</title>
    <link rel="stylesheet" href="style/style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css"
    />
    <style>
      /* Keep Male & Female buttons consistent */
      #toggle-male,
      #toggle-female {
        border-color: #6c757d !important;
      }
      /* Ensure equal panel height */
      .equal-height {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      /* Scrollable Adversary List */
      .scrollable-list {
        max-height: 400px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="row mt-4">
      <div class="col-md-12 px-5">
        <div class="w-100 px-4">
          <img
            src="./images/headers/page_header_encounter_architect.svg"
            alt="Adventure Architect"
            class="d-block w-100"
          />
        </div>
      </div>
    </div>

    <div class="container mt-4">
      <!-- Toast Notification Container -->
      <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div
          id="notification-toast"
          class="toast align-items-center text-white bg-success border-0"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="d-flex">
            <div class="toast-body" id="toast-message">
              Character added successfully!
            </div>
            <button
              type="button"
              class="btn-close btn-close-white me-2 m-auto"
              data-bs-dismiss="toast"
              aria-label="Close"
            ></button>
          </div>
        </div>
      </div>

      <!-- First Row: Party & Adversaries Panels -->
      <div class="row">
        <div class="col-md-6">
          <div class="card p-4 mb-4 equal-height">
            <section id="party-settings">
              <div class="w-100">
                <img
                  src="./images/headers/section_headers_character.svg"
                  alt="Characters"
                  class="d-block w-100 mb-3 silhouette_color"
                />
              </div>
              <div class="mb-3">
                <div class="input-group mb-3">
                  <span class="input-group-text">Name:</span>
                  <input
                    type="text"
                    id="character-name"
                    class="form-control"
                    placeholder="Enter Name"
                  />
                  <button id="regenerate-name" class="btn btn-secondary">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                  <button id="toggle-male" class="btn btn-secondary">
                    <i class="bi bi-gender-male"></i>
                  </button>
                  <button id="toggle-female" class="btn btn-secondary">
                    <i class="bi bi-gender-female"></i>
                  </button>
                </div>
              </div>
              <div class="mb-3">
                <div class="input-group mb-3">
                  <span class="input-group-text">Class:</span>
                  <select id="character-class" class="form-select"></select>
                </div>
              </div>
              <div class="mb-3">
                <div class="input-group mb-3">
                  <span class="input-group-text">Level:</span>
                  <select id="character-level" class="form-select"></select>
                </div>
              </div>
              <button id="add-character" class="btn btn-primary w-100">
                Add to Party
              </button>
            </section>
            <div class="class-preview">
              <img
                id="class-image"
                src=""
                alt="Class Image"
                class="d-block mx-auto silhouette_color"
                style="width: 60%"
              />
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card p-4 equal-height">
            <section id="adversary-selection">
              <div class="w-100">
                <img
                  src="./images/headers/section_headers_adversary.svg"
                  alt="Adversaries"
                  class="d-block w-100 mb-3 silhouette_color"
                />
              </div>
              <!-- Filter Buttons & Clear Filters -->
              <div class="d-flex align-items-center justify-content-between">
                <div class="btn-group mb-2" role="group">
                  <button
                    id="toggle-cr"
                    class="btn btn-secondary filter-btn"
                    data-filter="cr"
                  >
                    CR
                  </button>
                  <button
                    id="toggle-xp"
                    class="btn btn-secondary filter-btn"
                    data-filter="xp"
                  >
                    XP
                  </button>
                  <button
                    id="toggle-habitat"
                    class="btn btn-secondary filter-btn"
                    data-filter="habitat"
                  >
                    Habitat
                  </button>
                  <button
                    id="toggle-type"
                    class="btn btn-secondary filter-btn"
                    data-filter="type"
                  >
                    Type
                  </button>
                  <button
                    id="toggle-group"
                    class="btn btn-secondary filter-btn"
                    data-filter="group"
                  >
                    Group
                  </button>
                </div>

                <!-- Clear Filters Icon Button with Tooltip -->
                <button
                  id="clear-filters"
                  class="btn btn-primary ms-2"
                  data-bs-toggle="tooltip"
                  title="Clear all filters"
                >
                  <img
                    src="images/icons/icon_sweep.svg"
                    alt="Clear"
                    width="16"
                    height="16"
                  />
                </button>
              </div>

              <!-- Filter Dropdowns (Initially Hidden) -->
              <div id="filter-dropdowns" class="mb-3">
                <div id="filter-cr-div" class="filter-div d-none">
                  <select id="filter-cr" class="form-select form-select-sm">
                    <option value="">Select CR</option>
                  </select>
                </div>

                <div id="filter-xp-div" class="filter-div d-none">
                  <div class="input-group input-group-sm">
                    <input
                      type="number"
                      id="filter-xp-min"
                      class="form-control"
                      placeholder="Min XP"
                    />
                    <span class="input-group-text">-</span>
                    <input
                      type="number"
                      id="filter-xp-max"
                      class="form-control"
                      placeholder="Max XP"
                    />
                  </div>
                </div>

                <div id="filter-habitat-div" class="filter-div d-none">
                  <select
                    id="filter-habitat"
                    class="form-select form-select-sm"
                  >
                    <option value="">Select Habitat</option>
                  </select>
                </div>

                <div id="filter-type-div" class="filter-div d-none">
                  <select id="filter-type" class="form-select form-select-sm">
                    <option value="">Select Type</option>
                  </select>
                </div>

                <div id="filter-group-div" class="filter-div d-none">
                  <select id="filter-group" class="form-select form-select-sm">
                    <option value="">Select Group</option>
                  </select>
                </div>
              </div>
              <div class="d-flex align-items-center justify-content-between">
                <!-- Search Bar -->
                <input
                  type="text"
                  id="search-adversary"
                  class="form-control"
                  placeholder="Search adversaries..."
                />
                <!-- Adversary Count -->
                <div
                  id="adversary-count"
                  class="p-2 bg-primary text-white rounded ms-2"
                ></div>
              </div>
              <!-- Applied Filters -->
              <div id="applied-filters" class="mb-2"></div>
              <!-- Adversary List -->
              <div id="adversary-list" class="overflow-auto border p-2"></div>
            </section>
          </div>
        </div>
      </div>

      <!-- Second Row: Encounter Details Panel (Full Width) -->
      <div class="row mt-4">
        <div class="col-md-12">
          <div class="card p-3">
            <section
              id="encounter-summary"
              class="d-flex flex-wrap align-items-center justify-content-between"
            >
              <!-- Left Group -->
              <div class="d-flex align-items-center flex-wrap gap-3">
                <!-- Average Party Level -->
                <div
                  class="d-flex align-items-center stat-box btn-group-height"
                >
                  <div class="stat-label bg-secondary text-white px-3 py-2">
                    APL
                  </div>
                  <div
                    class="stat-value border border-secondary border-3 border-l-0"
                    style="border-left: 0px"
                  >
                    <span
                      id="average-party-level"
                      class="mx-4 my-1 text-secondary"
                      >0</span
                    >
                  </div>
                </div>

                <!-- Encounter Difficulty -->
                <div class="btn-group" role="group" id="encounter-difficulty">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="difficulty-low"
                  >
                    Low
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary active"
                    id="difficulty-moderate"
                  >
                    Moderate
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="difficulty-high"
                  >
                    High
                  </button>
                </div>

                <!-- XP Calculation Mode -->
                <div class="btn-group" role="group" id="xp-mode">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    id="xp-individual"
                  >
                    <i class="bi bi-person"></i>
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary active"
                    id="xp-group"
                  >
                    <i class="bi bi-people"></i>
                  </button>
                </div>
              </div>

              <!-- Right Group -->
              <div class="d-flex align-items-center flex-wrap gap-3">
                <!-- XP Budget -->
                <div
                  class="d-flex align-items-center stat-box btn-group-height"
                >
                  <div
                    class="stat-label bg-secondary text-white px-3 py-2 text-uppercase"
                  >
                    Budget
                  </div>
                  <div
                    class="stat-value border border-secondary border-3 border-l-0"
                    style="border-left: 0px"
                  >
                    <span id="xp-budget" class="mx-4 my-1 text-secondary"
                      >0</span
                    >
                  </div>
                </div>

                <div
                  class="d-flex align-items-center stat-box btn-group-height"
                >
                  <div
                    class="stat-label bg-secondary text-white px-3 py-2 text-uppercase"
                  >
                    Encounter
                  </div>
                  <div
                    class="stat-value border border-secondary border-3 border-l-0"
                    style="border-left: 0px"
                  >
                    <span id="bad-guys-xp" class="mx-4 my-1 text-secondary"
                      >0</span
                    >
                  </div>
                </div>

                <!-- Encounter Balance -->
                <div
                  class="d-flex align-items-center stat-box btn-group-height"
                >
                  <div
                    class="stat-label bg-secondary text-white px-3 py-2 text-uppercase"
                  >
                    Balance
                  </div>
                  <div
                    class="stat-value border border-secondary border-3 border-l-0"
                    style="border-left: 0px"
                  >
                    <span id="encounter-balance" class="mx-4 my-1">0</span>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>

      <!-- Third Row: Good Guys & Bad Guys Panels -->
      <div class="row mt-4 mb-4">
        <div class="col-md-6">
          <div class="card p-4 mb-4 equal-height">
            <section id="good-guys">
              <div class="w-100">
                <img
                  src="./images/headers/section_headers_party.svg"
                  alt="Adversaries"
                  class="d-block w-100 mb-3 silhouette_color"
                />
              </div>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Level</th>
                    <th>Class</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="character-table-body"></tbody>
              </table>
            </section>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card p-4 mb-4 equal-height">
            <section id="bad-guys">
              <div class="w-100">
                <img
                  src="./images/headers/section_headers_encounter.svg"
                  alt="Adversaries"
                  class="d-block w-100 mb-3 silhouette_color"
                />
              </div>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Adversary</th>
                    <th>CR</th>
                    <th>XP</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="adversary-table-body"></tbody>
              </table>
            </section>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script/adversaryData.js"></script>
    <script src="script/adversaryManager.js"></script>
    <script src="script/adversaryUI.js"></script>
    <script src="script/adversaryFilters.js"></script>
    <script src="script/adversaryController.js"></script>
    <script src="script/nameGenerator.js"></script>
    <script src="script/partyPanel.js"></script>
    <script src="script/partyCalculations.js"></script>
    <script src="script/script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var tooltipTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
          new bootstrap.Tooltip(tooltipTriggerEl);
        });
      });
    </script>
  </body>
</html>
